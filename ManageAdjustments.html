<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ICM - Manage Adjustments</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/adjustments.css">
    <link rel="stylesheet" href="css/toast.css">
    <link rel="shortcut icon" href="https://backend.quadient.com/files/default/favicon-quadient.png">
</head>
<body>
    <header class="icm-header">
        <div class="header-container">
            <a href="index.html" class="header-brand">
                <div class="header-logo">
                    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="12" y1="1" x2="12" y2="23"></line>
                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                    </svg>
                </div>
                <div class="header-titles">
                    <span class="header-app-name">ICM</span>
                    <span class="header-app-desc">Incentive & Compensation Management</span>
                </div>
            </a>

            <nav class="header-nav">
                <a href="index.html" class="nav-link">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                    Home
                </a>
                <a href="ICMProcessRunner.html" class="nav-link">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="5 3 19 12 5 21 5 3"></polygon>
                    </svg>
                    Run Process
                </a>
            </nav>

            <div class="server-info">
                <div class="server-info-item">
                    <span class="server-info-label">Server</span>
                    <span class="server-info-value loading" id="serverInfoServer">Loading...</span>
                </div>
                <div class="server-info-item">
                    <span class="server-info-label">Sales Period</span>
                    <span class="server-info-value loading" id="serverInfoSP">Loading...</span>
                </div>
                <div class="server-info-item">
                    <span class="server-info-label">Status</span>
                    <span class="server-info-value loading" id="serverInfoStatus">Loading...</span>
                </div>
                <div class="server-info-item">
                    <span class="server-info-label">Last Run</span>
                    <span class="server-info-value loading" id="serverInfoLastRun">Loading...</span>
                </div>
            </div>

            <div class="header-right">
                <svg xmlns="http://www.w3.org/2000/svg" width="200" height="50" viewBox="0 0 200 50" class="quadient-logo">
                    <g transform="translate(0.007 0)">
                        <path d="M23.781,64.111a1.528,1.528,0,0,1,.432,1.1V99.323a1.443,1.443,0,0,1-.432,1.074,1.6,1.6,0,0,1-2.172,0,1.44,1.44,0,0,1-.428-1.074v-15a10.835,10.835,0,0,1-3.769,3.9,10.046,10.046,0,0,1-5.534,1.6A11,11,0,0,1,5.832,88.1,12.084,12.084,0,0,1,1.562,83.32a15.655,15.655,0,0,1,0-13.656,12.069,12.069,0,0,1,4.271-4.777,10.9,10.9,0,0,1,5.991-1.726,10.752,10.752,0,0,1,5.514,1.476,10.156,10.156,0,0,1,3.843,3.827V65.21a1.515,1.515,0,0,1,2.6-1.1Zm-6.875,21.56a9.18,9.18,0,0,0,3.288-3.778,12.2,12.2,0,0,0,1.189-5.427,11.938,11.938,0,0,0-1.189-5.353,9.409,9.409,0,0,0-3.288-3.776,8.426,8.426,0,0,0-4.728-1.377A8.427,8.427,0,0,0,7.45,67.336a9.37,9.37,0,0,0-3.283,3.776,12.755,12.755,0,0,0,0,10.756A9.363,9.363,0,0,0,7.45,85.646a8.442,8.442,0,0,0,4.728,1.376,8.555,8.555,0,0,0,4.728-1.351Z" transform="translate(0 -50.824)" fill="white"></path>
                        <path d="M183.083,66.432a1.512,1.512,0,0,1,.421,1.094v14.33q0,4.98-2.734,7.649a10.391,10.391,0,0,1-7.568,2.667,10.228,10.228,0,0,1-7.495-2.667q-2.712-2.667-2.71-7.649V67.526a1.512,1.512,0,0,1,.421-1.094,1.545,1.545,0,0,1,2.143,0,1.511,1.511,0,0,1,.421,1.094v14.33a7.57,7.57,0,0,0,1.892,5.564,7.161,7.161,0,0,0,5.327,1.906,7.328,7.328,0,0,0,5.4-1.906,7.524,7.524,0,0,0,1.916-5.564V67.526a1.5,1.5,0,0,1,.425-1.094A1.539,1.539,0,0,1,183.083,66.432Z" transform="translate(-131.167 -53.11)" fill="white"></path>
                        <path d="M323.4,65.047a1.535,1.535,0,0,1,.425,1.1V88.569a1.492,1.492,0,1,1-2.984,0v-3.34a10.461,10.461,0,0,1-3.732,3.789,10.083,10.083,0,0,1-5.421,1.544,10.7,10.7,0,0,1-6-1.744,11.994,11.994,0,0,1-4.178-4.785,15.073,15.073,0,0,1-1.513-6.827,14.7,14.7,0,0,1,1.543-6.8,11.858,11.858,0,0,1,4.2-4.711,11.1,11.1,0,0,1,11.367-.249,9.522,9.522,0,0,1,3.732,3.789V66.144a1.531,1.531,0,0,1,.421-1.1,1.5,1.5,0,0,1,2.137,0ZM316.638,86.4a9.3,9.3,0,0,0,3.235-3.789,12.3,12.3,0,0,0,1.17-5.408,11.9,11.9,0,0,0-1.17-5.283,9.341,9.341,0,0,0-3.235-3.761,8.215,8.215,0,0,0-4.652-1.371,8.323,8.323,0,0,0-4.651,1.346,9.139,9.139,0,0,0-3.231,3.711,11.92,11.92,0,0,0-1.17,5.358,12.456,12.456,0,0,0,1.146,5.408,9.089,9.089,0,0,0,3.206,3.789A8.659,8.659,0,0,0,316.638,86.4Z" transform="translate(-241.413 -51.501)" fill="white"></path>
                        <path d="M475.781.427a1.452,1.452,0,0,1,.432,1.079V37.053a1.453,1.453,0,0,1-.432,1.079,1.6,1.6,0,0,1-2.172,0,1.449,1.449,0,0,1-.428-1.079V33.535a10.848,10.848,0,0,1-3.77,3.919,10.014,10.014,0,0,1-5.534,1.608,10.969,10.969,0,0,1-6.044-1.734,12.118,12.118,0,0,1-4.271-4.8,14.888,14.888,0,0,1-1.568-6.883,14.776,14.776,0,0,1,1.568-6.832,12.1,12.1,0,0,1,4.271-4.8,10.863,10.863,0,0,1,5.991-1.734,10.716,10.716,0,0,1,5.514,1.482,10.178,10.178,0,0,1,3.843,3.843V1.507a1.449,1.449,0,0,1,.428-1.079,1.594,1.594,0,0,1,2.172,0Zm-6.875,34.464a9.206,9.206,0,0,0,3.288-3.794,12.3,12.3,0,0,0,1.189-5.449,12.034,12.034,0,0,0-1.189-5.377,9.438,9.438,0,0,0-3.288-3.792,8.777,8.777,0,0,0-9.455,0,9.4,9.4,0,0,0-3.283,3.792,11.976,11.976,0,0,0-1.189,5.377,12.082,12.082,0,0,0,1.189,5.426,9.393,9.393,0,0,0,3.283,3.794,8.416,8.416,0,0,0,4.728,1.382,8.526,8.526,0,0,0,4.727-1.358Z" transform="translate(-363.72 0)" fill="white"></path>
                        <path d="M618.682,91.359a1.7,1.7,0,0,1-2.239,0A1.4,1.4,0,0,1,616,90.294V67.489a1.41,1.41,0,0,1,.445-1.067,1.7,1.7,0,0,1,2.239,0,1.406,1.406,0,0,1,.441,1.067V90.294a1.4,1.4,0,0,1-.441,1.065Z" transform="translate(-495.692 -53.11)" fill="#00c4b3"></path>
                        <path d="M625.281,1.562A1.437,1.437,0,0,0,623.719,0H613.563A1.437,1.437,0,0,0,612,1.562a1.437,1.437,0,0,0,1.563,1.562h8.594v8.594a1.563,1.563,0,0,0,3.125,0Z" transform="translate(-492.476 0)" fill="#00c4b3"></path>
                        <path d="M696.988,76.882a1.5,1.5,0,0,1-1.056.424H676.918a11.407,11.407,0,0,0,1.232,5.355,9.232,9.232,0,0,0,3.52,3.74,10.371,10.371,0,0,0,5.407,1.37,9.222,9.222,0,0,0,4.326-1,8.88,8.88,0,0,0,3.066-2.541,1.7,1.7,0,0,1,1.056-.45,1.252,1.252,0,0,1,.9.4,1.231,1.231,0,0,1,.405.9,1.465,1.465,0,0,1-.5,1.046,12.628,12.628,0,0,1-4.048,3.19,11.194,11.194,0,0,1-5.158,1.247,13.869,13.869,0,0,1-6.84-1.645,11.746,11.746,0,0,1-4.629-4.611,13.794,13.794,0,0,1-1.655-6.852,14.984,14.984,0,0,1,1.633-7.15,11.72,11.72,0,0,1,4.351-4.686A11.13,11.13,0,0,1,685.768,64a11.929,11.929,0,0,1,5.661,1.4,11.08,11.08,0,0,1,4.3,4.086,12.2,12.2,0,0,1,1.711,6.379,1.359,1.359,0,0,1-.448,1.022Zm-16.627-8a9.238,9.238,0,0,0-3.193,5.731h17.15v-.4a7.851,7.851,0,0,0-1.506-3.912,8.2,8.2,0,0,0-3.144-2.543,9.232,9.232,0,0,0-3.9-.871A8.481,8.481,0,0,0,680.361,68.882Z" transform="translate(-542.367 -51.5)" fill="white"></path>
                        <path d="M842.906,66.727a11.22,11.22,0,0,1,2.182,7.231V88.671a1.41,1.41,0,0,1-.453,1.074,1.543,1.543,0,0,1-2.129,0,1.448,1.448,0,0,1-.424-1.074V74.108a8.162,8.162,0,0,0-1.631-5.28,6.076,6.076,0,0,0-5.036-2.026,9,9,0,0,0-7.213,3.677,6.092,6.092,0,0,0-1.2,3.629V88.671a1.5,1.5,0,1,1-3.005,0V66.252a1.5,1.5,0,1,1,3.005,0V69a10.63,10.63,0,0,1,3.882-3.578A10.446,10.446,0,0,1,836.068,64Q840.728,64,842.906,66.727Z" transform="translate(-663.064 -51.5)" fill="white"></path>
                        <path d="M964.327,41.823v16.71a3.5,3.5,0,0,0,.72,2.569,1.952,1.952,0,0,0,1.589.672,3.085,3.085,0,0,0,.774-.124,2.939,2.939,0,0,1,.719-.124,1.031,1.031,0,0,1,.795.373,1.275,1.275,0,0,1,.335.873,1.37,1.37,0,0,1-.824,1.173,3.865,3.865,0,0,1-1.953.473,8.3,8.3,0,0,1-2.153-.25,3.923,3.923,0,0,1-2.083-1.5,6.36,6.36,0,0,1-1-3.99V41.823h-3.753a1.5,1.5,0,0,1-1.055-.4,1.361,1.361,0,0,1,0-2,1.512,1.512,0,0,1,1.055-.4h3.753V33.494a1.431,1.431,0,0,1,.439-1.074,1.656,1.656,0,0,1,2.209,0,1.431,1.431,0,0,1,.439,1.074V39.03h3.513a1.371,1.371,0,0,1,1,.449,1.406,1.406,0,0,1,.435,1,1.247,1.247,0,0,1-.41.972,1.47,1.47,0,0,1-1.029.373Z" transform="translate(-769.287 -25.748)" fill="white"></path>
                    </g>
                </svg>
            </div>
        </div>
    </header>

    <div class="content">
        <div class="title">
            <h2>Manage Adjustments</h2>
        </div>

        <!-- Upload Section -->
        <div class="upload-section" id="uploadSection">
            <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
                <div class="upload-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17 8 12 3 7 8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                </div>
                <h3>Upload Adjustments File</h3>
                <p>Drag & drop your Excel file here or click to browse</p>
                <p class="file-hint">Supported format: .xlsx</p>
            </div>
            <input type="file" id="fileInput" class="file-input" accept=".xlsx,.xls" onchange="handleFileSelect(event)">
            <div class="file-name" id="fileName"></div>
        </div>

        <!-- Loading Modal -->
        <div id="loadingModal" class="modal-overlay" style="display: none;">
            <div class="modal-content">
                <div class="spinner"></div>
                <h3 id="loadingTitle">Processing...</h3>
                <p id="loadingText">Please wait while we process your request.</p>
            </div>
        </div>

        <!-- Message Box -->
        <div class="message-box" id="messageBox">
            <h4 id="messageTitle"></h4>
            <p id="messageText"></p>
        </div>

        <!-- Results Section -->
        <div class="results-section" id="resultsSection">
            <div class="results-header">
                <div class="results-info">
                    <h3>Adjustments Preview</h3>
                    <p><span class="count" id="adjustmentCount">0</span> adjustments found in file</p>
                </div>
                <div class="results-actions">
                    <button type="button" class="btn-cancel" onclick="cancelImport()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                        Cancel
                    </button>
                    <button type="button" class="btn-validate" id="btnValidate" onclick="validateAdjustments()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                        Validate & Import
                    </button>
                </div>
            </div>
            <div class="table-container">
                <div class="table-scroll">
                    <table class="adjustments-table" id="adjustmentsTable">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Adjustment Type</th>
                                <th>Position ID</th>
                                <th>Employee ID</th>
                                <th>Order ID</th>
                                <th>Allocation Type</th>
                                <th>Allocation Value</th>
                                <th>Allocation List</th>
                                <th>Exclude</th>
                                <th>Reason</th>
                                <th>Date</th>
                                <th>By</th>
                                <th>Period</th>
                                <th>Order Number</th>
                            </tr>
                        </thead>
                        <tbody id="adjustmentsBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Process Section -->
        <div class="process-section" id="processSection">
            <div class="process-card">
                <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#1e3a5f" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-bottom: 20px;">
                    <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
                <h3>Adjustments Validated Successfully!</h3>
                <p id="insertedCount">0 adjustments have been imported into the database.</p>
                <button type="button" class="btn-process" onclick="runProcess()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="5 3 19 12 5 21 5 3"></polygon>
                    </svg>
                    Run Calculation Process
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.0/signalr.min.js"></script>
    <script src="js/config.js"></script>
    <script src="js/common.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/adjustments.js"></script>
</body>
</html>
